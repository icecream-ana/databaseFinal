## 实体

> 注：“其他”属性不是作业中规定的必要属性，可拓展
> 
> 所有状态类属性均应使用CHECK约束

- 配送中心（centers）
  
  - 配送中心ID（主键）
  
  - 配送中心名称
  
  - 其他（如联系方式等）
    
    | 字段名         | 类型           | 是否为主键 | 是否为外键 | 是否允许为空 | 默认值 | 说明     |
    | ----------- | ------------ | ----- | ----- | ------ | --- | ------ |
    | center_id   | INT          | 是     | 否     | 否      |     | 配送中心ID |
    | center_name | VARCHAR(100) | 否     | 否     | 否      |     | 配送中心名称 |

- 车队（fleets）
  
  - 车队ID（主键）
  
  - 车队名称
  
  - 所属配送中心ID（外键，关联到配送中心）
    
    | 字段名        | 类型           | 是否为主键 | 是否为外键      | 是否允许为空 | 默认值 | 说明       |
    | ---------- | ------------ | ----- | ---------- | ------ | --- | -------- |
    | fleet_id   | INT          | 是     | 否          | 否      |     | 车队ID     |
    | fleet_name | VARCHAR(100) | 否     | 否          | 否      |     | 车队名称     |
    | center_id  | INT          | 否     | 是(centers) | 否      |     | 所属配送中心ID |

- 车辆（vehicles）
  
  - 车辆ID（主键）
  
  - 最大载重
  
  - 最大容积
  
  - 所属车队ID（外键，关联到车队）
  
  - 状态：空闲/运输中/异常
  
  - 车牌号（唯一索引，但是车牌号可以更换，不适合作为主键）
    
    | 字段名                  | 类型            | 是否为主键 | 是否为外键     | 是否允许为空 | 默认值  | 说明           |
    | -------------------- | ------------- | ----- | --------- | ------ | ---- | ------------ |
    | vehicle_id           | INT           | 是     | 否         | 否      |      | 车辆ID         |
    | max_weight           | DECIMAL(10,2) | 否     | 否         | 否      |      | 最大载重(kg)     |
    | max_volume           | DECIMAL(10,2) | 否     | 否         | 否      |      | 最大容积(m³)     |
    | fleet_id             | INT           | 否     | 是(fleets) | 否      |      | 所属车队ID       |
    | status               | VARCHAR(20)   | 否     | 否         | 否      | '空闲' | 状态：空闲/运输中/异常 |
    | license_plate_number | VARCHAR(50)   | 否     | 否         | 否      |      | 车牌号（唯一索引）    |

- 司机（drivers）
  
  - 工号（主键）
  
  - 姓名
  
  - 联系方式
  
  - 驾照等级：C1/C2/B2/A2（记录最高等级）
  
  - 所属车队ID（外键，关联到车队）
  
  - 其他个人信息
    
    | 字段名           | 类型          | 是否为主键 | 是否为外键     | 是否允许为空 | 默认值 | 说明     |
    | ------------- | ----------- | ----- | --------- | ------ | --- | ------ |
    | driver_id     | INT         | 是     | 否         | 否      |     | 工号     |
    | name          | VARCHAR(50) | 否     | 否         | 否      |     | 姓名     |
    | license_level | VARCHAR(10) | 否     | 否         | 否      |     | 驾照等级   |
    | phone         | VARCHAR(50) | 否     | 否         | 否      |     | 联系方式   |
    | fleet_id      | INT         | 否     | 是(fleets) | 否      |     | 所属车队ID |

- 主管（supervisors）
  
  - 工号（主键）
  - 姓名
  - 联系方式
  - 所属车队ID（外键，关联到车队）
  
  | 字段名           | 类型          | 是否为主键 | 是否为外键     | 是否允许为空 | 默认值 | 说明     |
  | ------------- | ----------- | ----- | --------- | ------ | --- | ------ |
  | supervisor_id | INT         | 是     | 否         | 否      |     | 工号     |
  | name          | VARCHAR(50) | 否     | 否         | 否      |     | 姓名     |
  | phone         | VARCHAR(50) | 否     | 否         | 否      |     | 联系方式   |
  | fleet_id      | INT         | 否     | 是(fleets) | 否      |     | 所属车队ID |

- 运单（orders）
  
  - 运单ID（主键）
  - 货物重量
  - 货物体积
  - 目的地
  - 创建时间
  - 执行车辆ID（外键，关联到车辆）
  - 执行司机ID（外键，关联到司机）
  - 状态：待分配/运输中/已完成/异常
  
  | 字段名         | 类型            | 是否为主键 | 是否为外键       | 是否允许为空 | 默认值               | 说明             |
  | ----------- | ------------- | ----- | ----------- | ------ | ----------------- | -------------- |
  | order_id    | INT           | 是     | 否           | 否      |                   | 运单ID           |
  | weight      | DECIMAL(10,2) | 否     | 否           | 否      |                   | 货物重量(kg)       |
  | volume      | DECIMAL(10,2) | 否     | 否           | 否      |                   | 货物体积(m³)       |
  | destination | VARCHAR(255)  | 否     | 否           | 否      |                   | 目的地            |
  | created_at  | DATETIME      | 否     | 否           | 否      | CURRENT_TIMESTAMP | 创建时间           |
  | vehicle_id  | INT           | 否     | 是(vehicles) | 否      |                   | 执行车辆ID         |
  | driver_id   | INT           | 否     | 是           | 否      |                   | 执行司机ID         |
  | status      | VARCHAR(20)   | 否     | 否           | 否      | '待分配'             | 状态：待分配/运输中/已完成 |

- 异常事件（exception_events）
  
  - 事件ID（主键）
  - 任务ID（外键）
  - 异常类型：运输时异常/空闲时异常
  - 罚款金额
  - 发生时间
  - 描述：具体异常描述（如货物破损 / 车辆故障 / 严重延误 / 超速报警）
  - 状态：待处理/处理中/已处理
  
  | 字段名            | 类型          | 是否为主键 | 是否为外键    | 是否允许为空 | 默认值   | 说明         |
  | -------------- | ----------- | ----- | -------- | ------ | ----- | ---------- |
  | event_id       | INT         | 是     | 否        | 否      |       | 事件ID       |
  | order_id       | INT         | 否     | 是(tasks) | 否      |       | 运单ID       |
  | exception_type | VARCHAR(50) | 否     | 否        | 否      |       | 异常类型       |
  | fine_amount    | INT         | 否     | 否        | 否      | 0     | 罚款金额       |
  | occurred_time  | DATETIME    | 否     | 否        | 否      |       | 发生时间       |
  | description    | TEXT        | 否     | 否        | 否      |       | 具体异常描述     |
  | status         | VARCHAR(20) | 否     | 否        | 否      | '待处理' | 状态：待处理/已处理 |

- 审计日志表（history_log）
  
  - 日志ID（主键）
  - 修改表名
  - 修改条目ID（比如修改drivers表，对应存储driver_id）
  - 操作类型（如'update_driver_license'/ 'handle_exception'，可以拓展更多以覆盖所有修改操作，确保日志完整性）
  - 旧数据（用JSON存储）
  - 修改时间
  
  | 字段名            | 类型                 | 是否为主键 | 是否为外键 | 是否允许为空 | 默认值               | 说明                                 |
  | -------------- | ------------------ | ----- | ----- | ------ | ----------------- | ---------------------------------- |
  | log_id         | INT                | 是     | 否     | 否      |                   | 日志ID                               |
  | table_name     | VARCHAR(50)        | 否     | 否     | 否      |                   | 修改表名                               |
  | change_id      | INT                | 否     | 否     | 否      |                   | 修改条目ID（比如修改drivers表，对应存储driver_id） |
  | operation_type | VARCHAR(50)        | 否     | 否     | 否      |                   | 操作类型                               |
  | old_data       | JSON/NVARCHAR(MAX) | 否     | 否     | 否      |                   | 旧数据                                |
  | change_at      | DATETIME           | 否     | 否     | 否      | CURRENT_TIMESTAMP | 修改时间                               |

## 关系

- 一个配送中心**管辖**若干车队（1：N）
- 一个车队**拥有**若干车辆（1：N）
- 一个车队**拥有**若干司机（1：N）
- 一个车队**拥有**一个主管（1：1）
- 一辆车辆**执行**若干运单（1：N）
- 一个司机**执行**若干运单（1：N）
- 一个运单**发生**若干异常事件（1：N）